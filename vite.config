// vite.config.js
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";

/**
 * Vite config for spotify-clone
 *
 * Notes:
 * - When deploying to GitHub Pages, keep base set to '/spotify-clone/'.
 *   Alternatively you can set an environment var VITE_BASE to override it.
 * - optimizeDeps.include helps avoid the \"Could not auto-determine entry point\" warning.
 */

export default defineConfig(({ mode }) => {
  // You can override the base at build time with: VITE_BASE='/spotify-clone/' npm run build
  const baseFromEnv = process.env.VITE_BASE;
  const base = baseFromEnv ?? "/"; // set '/spotify-clone/' for GitHub Pages if needed

  return {
    base,
    plugins: [react()],
    resolve: {
      alias: {
        "@": path.resolve(__dirname, "src"),
      },
    },
    server: {
      port: 5173,
      open: true,
    },
    preview: {
      port: 5173,
      open: false,
    },
    optimizeDeps: {
      // explicitly include common deps used by the app to avoid pre-bundling issues
      include: ["react", "react-dom", "react-router-dom"],
    },
    build: {
      outDir: "dist",
      sourcemap: false,
      // you can add rollupOptions if needed for advanced builds
    },
  };
});
